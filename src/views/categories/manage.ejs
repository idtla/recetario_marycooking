<%- include('../partials/header') %>

<div class="container px-6 mx-auto">
  <h2 class="my-6 text-2xl font-semibold text-gray-700">
    Gestión de Categorías
  </h2>

  <!-- Botón Nueva Categoría -->
  <div class="mb-8">
    <button @click="window.location.href='/categories/create'" 
            class="px-4 py-2 text-sm font-medium text-white bg-pink-600 hover:bg-pink-700">
      + Nueva Categoría
    </button>
  </div>

  <!-- Lista de Categorías -->
  <div class="w-full overflow-hidden rounded-lg shadow-xs">
    <div class="w-full overflow-x-auto">
      <table class="w-full whitespace-no-wrap">
        <thead>
          <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b bg-gray-100">
            <th class="px-6 py-3">NOMBRE</th>
            <th class="px-6 py-3" style="text-align: right; padding-right: 3rem;">ACCIONES</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y">
          <% categories.forEach((category, index) => { %>
            <!-- Categoría principal -->
            <tr class="<%= index % 2 === 0 ? 'bg-white' : 'bg-gray-50' %>">
              <td class="px-6 py-3">
                <div class="flex items-center text-sm">
                  <p class="font-bold text-gray-800">
                    <%= category.name %>
                  </p>
                </div>
              </td>
              <td class="px-6 py-3">
                <div class="flex items-center justify-end space-x-4 text-sm pr-8">
                  <a href="/categories/edit/<%= category.id %>" 
                     class="text-pink-600 hover:text-pink-800"
                     title="Editar">
                    <i class="fas fa-edit"></i>
                  </a>
                  <button onclick="deleteCategory('<%= category.id %>')"
                          class="text-red-600 hover:text-red-800"
                          title="Eliminar">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <!-- Subcategorías -->
            <% if (category.children && category.children.length > 0) { %>
              <% category.children.forEach(subcategory => { %>
                <tr class="<%= index % 2 === 0 ? 'bg-white' : 'bg-gray-50' %>">
                  <td class="px-6 py-2">
                    <div class="flex items-center text-sm">
                      <div class="pl-8 flex items-center">
                        <span class="text-gray-400 mr-2">--</span>
                        <p class="text-gray-600">
                          <%= subcategory.name %>
                        </p>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-2">
                    <div class="flex items-center justify-end space-x-4 text-sm pr-8">
                      <a href="/categories/edit/<%= subcategory.id %>" 
                         class="text-pink-600 hover:text-pink-800"
                         title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <button onclick="deleteCategory('<%= subcategory.id %>')"
                              class="text-red-600 hover:text-red-800"
                              title="Eliminar">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              <% }) %>
            <% } %>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
function deleteCategory(categoryId) {
  if (confirm('¿Estás seguro de que deseas eliminar esta categoría?')) {
    fetch(`/categories/delete/${categoryId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.reload();
      } else {
        alert('Error al eliminar la categoría');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error al eliminar la categoría');
    });
  }
}
</script> 